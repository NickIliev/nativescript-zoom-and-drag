"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var utils = require("tns-core-modules/utils/utils");
var ItemsComponent = /** @class */ (function () {
    function ItemsComponent() {
        this.states = ["unknown", "start", "change", "end"];
        this.startScale = 1;
    }
    ItemsComponent.prototype.ngOnInit = function () {
        this.item = this.angularItem.nativeElement;
        console.log("this.item: " + this.item);
        this.statusLbl = this.status.nativeElement;
        this.density = utils.layout.getDisplayDensity();
        this.item.translateX = 0;
        this.item.translateY = 0;
        this.item.scaleX = 1;
        this.item.scaleY = 1;
        this.updateStatus();
    };
    ItemsComponent.prototype.onPan = function (args) {
        // console.log("PAN[" + this.states[args.state] + "] deltaX: " + Math.round(args.deltaX) + " deltaY: " + Math.round(args.deltaY));
        // console.log("PAN state: " + this.states[args.state] + " ; PAN args.state: " + args.state);
        if (args.state === 1) {
            this.prevDeltaX = 0;
            this.prevDeltaY = 0;
        }
        else if (args.state === 2) {
            this.item.translateX += args.deltaX - this.prevDeltaX;
            this.item.translateY += args.deltaY - this.prevDeltaY;
            this.prevDeltaX = args.deltaX;
            this.prevDeltaY = args.deltaY;
        }
        this.updateStatus();
    };
    ItemsComponent.prototype.onPinch = function (args) {
        // console.log("PINCH[" + this.states[args.state] + "] scale: " + args.scale + " focusX: " + args.getFocusX() + " focusY: " + args.getFocusY());
        if (args.state === 1) {
            var newOriginX = args.getFocusX() - this.item.translateX;
            var newOriginY = args.getFocusY() - this.item.translateY;
            var oldOriginX = this.item.originX * this.item.getMeasuredWidth();
            var oldOriginY = this.item.originY * this.item.getMeasuredHeight();
            this.item.translateX += (oldOriginX - newOriginX) * (1 - this.item.scaleX);
            this.item.translateY += (oldOriginY - newOriginY) * (1 - this.item.scaleY);
            this.item.originX = newOriginX / this.item.getMeasuredWidth();
            this.item.originY = newOriginY / this.item.getMeasuredHeight();
            this.startScale = this.item.scaleX;
        }
        else if (args.scale && args.scale !== 1) {
            var newScale = this.startScale * args.scale;
            newScale = Math.min(8, newScale);
            newScale = Math.max(0.125, newScale);
            this.item.scaleX = newScale;
            this.item.scaleY = newScale;
        }
    };
    ItemsComponent.prototype.onDoubleTap = function (args) {
        // console.log("DOUBLETAP");
        var _this = this;
        this.item.animate({
            translate: { x: 0, y: 0 },
            scale: { x: 1, y: 1 },
            curve: "easeOut",
            duration: 300
        }).then(function () {
            _this.updateStatus();
        });
        this.updateStatus();
    };
    ItemsComponent.prototype.updateStatus = function () {
        var text = "translate: [" + Math.round(this.item.translateX) + ", " + Math.round(this.item.translateY) + "]" +
            "\nscale: [" + (Math.round(this.item.scaleX * 100) / 100) + ", " + (Math.round(this.item.scaleY * 100) / 100) + "]" +
            "\norigin: [" + Math.round(this.item.originX * this.item.getMeasuredWidth()) + ", " + Math.round(this.item.originY * this.item.getMeasuredHeight()) + "]";
        this.statusLbl.text = text;
    };
    __decorate([
        core_1.ViewChild("item"),
        __metadata("design:type", core_1.ElementRef)
    ], ItemsComponent.prototype, "angularItem", void 0);
    __decorate([
        core_1.ViewChild("status"),
        __metadata("design:type", core_1.ElementRef)
    ], ItemsComponent.prototype, "status", void 0);
    ItemsComponent = __decorate([
        core_1.Component({
            selector: "ns-items",
            moduleId: module.id,
            templateUrl: "./items.component.html",
        }),
        __metadata("design:paramtypes", [])
    ], ItemsComponent);
    return ItemsComponent;
}());
exports.ItemsComponent = ItemsComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXRlbXMuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiaXRlbXMuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQWlFO0FBTWpFLG9EQUFzRDtBQVF0RDtJQWFJO1FBTkEsV0FBTSxHQUFHLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFJL0MsZUFBVSxHQUFHLENBQUMsQ0FBQztJQUVDLENBQUM7SUFFakIsaUNBQVEsR0FBUjtRQUNJLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUM7UUFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7UUFFM0MsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFFaEQsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQztRQUN6QixJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFDckIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBRXJCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUN4QixDQUFDO0lBRUQsOEJBQUssR0FBTCxVQUFNLElBQXlCO1FBQzNCLGtJQUFrSTtRQUNsSSw2RkFBNkY7UUFFN0YsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25CLElBQUksQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDO1lBQ3BCLElBQUksQ0FBQyxVQUFV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bEIsZ0JBQVMsQ0FBQyxNQUFNLENBQUM7a0NBQWMsaUJBQVU7dURBQUM7SUFHdEI7UUFBcEIsZ0JBQVMsQ0FBQyxRQUFRLENBQUM7a0NBQVMsaUJBQVU7a0RBQUM7SUFKL0IsY0FBYztRQUwxQixnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLFVBQVU7WUFDcEIsUUFBUSxFQUFFLE1BQU0sQ0FBQyxFQUFFO1lBQ25CLFdBQVcsRUFBRSx3QkFBd0I7U0FDeEMsQ0FBQzs7T0FDVyxjQUFjLENBaUcxQjtJQUFELHFCQUFDO0NBQUEsQUFqR0QsSUFpR0M7QUFqR1ksd0NBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIFZpZXdDaGlsZCwgRWxlbWVudFJlZiB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XHJcbmltcG9ydCB7IEV2ZW50RGF0YSB9IGZyb20gJ3Rucy1jb3JlLW1vZHVsZXMvZGF0YS9vYnNlcnZhYmxlJztcclxuaW1wb3J0IHsgUGFnZSB9IGZyb20gJ3Rucy1jb3JlLW1vZHVsZXMvdWkvcGFnZSc7XHJcbmltcG9ydCB7IExhYmVsIH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvbGFiZWxcIjtcclxuaW1wb3J0IHsgVmlldyB9IGZyb20gXCJ0bnMtY29yZS1tb2R1bGVzL3VpL2NvcmUvdmlld1wiO1xyXG5cclxuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdXRpbHMvdXRpbHNcIjtcclxuaW1wb3J0IHsgR2VzdHVyZUV2ZW50RGF0YSwgUGluY2hHZXN0dXJlRXZlbnREYXRhLCBQYW5HZXN0dXJlRXZlbnREYXRhIH0gZnJvbSBcInRucy1jb3JlLW1vZHVsZXMvdWkvZ2VzdHVyZXNcIjtcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6IFwibnMtaXRlbXNcIixcclxuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXHJcbiAgICB0ZW1wbGF0ZVVybDogXCIuL2l0ZW1zLmNvbXBvbmVudC5odG1sXCIsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBJdGVtc0NvbXBvbmVudCB7XHJcbiAgICBAVmlld0NoaWxkKFwiaXRlbVwiKSBhbmd1bGFySXRlbTogRWxlbWVudFJlZjtcclxuICAgIGl0ZW06IFZpZXc7XHJcblxyXG4gICAgQFZpZXdDaGlsZChcInN0YXR1c1wiKSBzdGF0dXM6IEVsZW1lbnRSZWY7XHJcbiAgICBzdGF0dXNMYmw6IExhYmVsO1xyXG5cclxuICAgIHN0YXRlcyA9IFtcInVua25vd25cIiwgXCJzdGFydFwiLCBcImNoYW5nZVwiLCBcImVuZFwiXTtcclxuICAgIGRlbnNpdHk6IG51bWJlcjtcclxuICAgIHByZXZEZWx0YVg6IG51bWJlcjtcclxuICAgIHByZXZEZWx0YVk6IG51bWJlcjtcclxuICAgIHN0YXJ0U2NhbGUgPSAxO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKCkgeyB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5pdGVtID0gdGhpcy5hbmd1bGFySXRlbS5uYXRpdmVFbGVtZW50O1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwidGhpcy5pdGVtOiBcIiArIHRoaXMuaXRlbSk7XHJcbiAgICAgICAgdGhpcy5zdGF0dXNMYmwgPSB0aGlzLnN0YXR1cy5uYXRpdmVFbGVtZW50O1xyXG5cclxuICAgICAgICB0aGlzLmRlbnNpdHkgPSB1dGlscy5sYXlvdXQuZ2V0RGlzcGxheURlbnNpdHkoKTtcclxuXHJcbiAgICAgICAgdGhpcy5pdGVtLnRyYW5zbGF0ZVggPSAwO1xyXG4gICAgICAgIHRoaXMuaXRlbS50cmFuc2xhdGVZID0gMDtcclxuICAgICAgICB0aGlzLml0ZW0uc2NhbGVYID0gMTtcclxuICAgICAgICB0aGlzLml0ZW0uc2NhbGVZID0gMTtcclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0dXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvblBhbihhcmdzOiBQYW5HZXN0dXJlRXZlbnREYXRhKSB7XHJcbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJQQU5bXCIgKyB0aGlzLnN0YXRlc1thcmdzLnN0YXRlXSArIFwiXSBkZWx0YVg6IFwiICsgTWF0aC5yb3VuZChhcmdzLmRlbHRhWCkgKyBcIiBkZWx0YVk6IFwiICsgTWF0aC5yb3VuZChhcmdzLmRlbHRhWSkpO1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiUEFOIHN0YXRlOiBcIiArIHRoaXMuc3RhdGVzW2FyZ3Muc3RhdGVdICsgXCIgOyBQQU4gYXJncy5zdGF0ZTogXCIgKyBhcmdzLnN0YXRlKTtcclxuXHJcbiAgICAgICAgaWYgKGFyZ3Muc3RhdGUgPT09IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5wcmV2RGVsdGFYID0gMDtcclxuICAgICAgICAgICAgdGhpcy5wcmV2RGVsdGFZID0gMDtcclxuICAgICAgICB9IGVsc2UgaWYgKGFyZ3Muc3RhdGUgPT09IDIpIHtcclxuICAgICAgICAgICAgdGhpcy5pdGVtLnRyYW5zbGF0ZVggKz0gYXJncy5kZWx0YVggLSB0aGlzLnByZXZEZWx0YVg7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS50cmFuc2xhdGVZICs9IGFyZ3MuZGVsdGFZIC0gdGhpcy5wcmV2RGVsdGFZO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5wcmV2RGVsdGFYID0gYXJncy5kZWx0YVg7XHJcbiAgICAgICAgICAgIHRoaXMucHJldkRlbHRhWSA9IGFyZ3MuZGVsdGFZO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0dXMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvblBpbmNoKGFyZ3M6IFBpbmNoR2VzdHVyZUV2ZW50RGF0YSkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKFwiUElOQ0hbXCIgKyB0aGlzLnN0YXRlc1thcmdzLnN0YXRlXSArIFwiXSBzY2FsZTogXCIgKyBhcmdzLnNjYWxlICsgXCIgZm9jdXNYOiBcIiArIGFyZ3MuZ2V0Rm9jdXNYKCkgKyBcIiBmb2N1c1k6IFwiICsgYXJncy5nZXRGb2N1c1koKSk7XHJcblxyXG4gICAgICAgIGlmIChhcmdzLnN0YXRlID09PSAxKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld09yaWdpblggPSBhcmdzLmdldEZvY3VzWCgpIC0gdGhpcy5pdGVtLnRyYW5zbGF0ZVg7XHJcbiAgICAgICAgICAgIGNvbnN0IG5ld09yaWdpblkgPSBhcmdzLmdldEZvY3VzWSgpIC0gdGhpcy5pdGVtLnRyYW5zbGF0ZVk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBvbGRPcmlnaW5YID0gdGhpcy5pdGVtLm9yaWdpblggKiB0aGlzLml0ZW0uZ2V0TWVhc3VyZWRXaWR0aCgpO1xyXG4gICAgICAgICAgICBjb25zdCBvbGRPcmlnaW5ZID0gdGhpcy5pdGVtLm9yaWdpblkgKiB0aGlzLml0ZW0uZ2V0TWVhc3VyZWRIZWlnaHQoKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS50cmFuc2xhdGVYICs9IChvbGRPcmlnaW5YIC0gbmV3T3JpZ2luWCkgKiAoMSAtIHRoaXMuaXRlbS5zY2FsZVgpO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW0udHJhbnNsYXRlWSArPSAob2xkT3JpZ2luWSAtIG5ld09yaWdpblkpICogKDEgLSB0aGlzLml0ZW0uc2NhbGVZKTtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS5vcmlnaW5YID0gbmV3T3JpZ2luWCAvIHRoaXMuaXRlbS5nZXRNZWFzdXJlZFdpZHRoKCk7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbS5vcmlnaW5ZID0gbmV3T3JpZ2luWSAvIHRoaXMuaXRlbS5nZXRNZWFzdXJlZEhlaWdodCgpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5zdGFydFNjYWxlID0gdGhpcy5pdGVtLnNjYWxlWDtcclxuICAgICAgICB9IGVsc2UgaWYgKGFyZ3Muc2NhbGUgJiYgYXJncy5zY2FsZSAhPT0gMSkge1xyXG4gICAgICAgICAgICBsZXQgbmV3U2NhbGUgPSB0aGlzLnN0YXJ0U2NhbGUgKiBhcmdzLnNjYWxlO1xyXG4gICAgICAgICAgICBuZXdTY2FsZSA9IE1hdGgubWluKDgsIG5ld1NjYWxlKTtcclxuICAgICAgICAgICAgbmV3U2NhbGUgPSBNYXRoLm1heCgwLjEyNSwgbmV3U2NhbGUpO1xyXG5cclxuICAgICAgICAgICAgdGhpcy5pdGVtLnNjYWxlWCA9IG5ld1NjYWxlO1xyXG4gICAgICAgICAgICB0aGlzLml0ZW0uc2NhbGVZID0gbmV3U2NhbGU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG9uRG91YmxlVGFwKGFyZ3M6IEdlc3R1cmVFdmVudERhdGEpIHtcclxuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkRPVUJMRVRBUFwiKTtcclxuXHJcbiAgICAgICAgdGhpcy5pdGVtLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICB0cmFuc2xhdGU6IHsgeDogMCwgeTogMCB9LFxyXG4gICAgICAgICAgICBzY2FsZTogeyB4OiAxLCB5OiAxIH0sXHJcbiAgICAgICAgICAgIGN1cnZlOiBcImVhc2VPdXRcIixcclxuICAgICAgICAgICAgZHVyYXRpb246IDMwMFxyXG4gICAgICAgIH0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnVwZGF0ZVN0YXR1cygpO1xyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVN0YXR1cygpIHtcclxuICAgICAgICBjb25zdCB0ZXh0ID0gXCJ0cmFuc2xhdGU6IFtcIiArIE1hdGgucm91bmQodGhpcy5pdGVtLnRyYW5zbGF0ZVgpICsgXCIsIFwiICsgTWF0aC5yb3VuZCh0aGlzLml0ZW0udHJhbnNsYXRlWSkgKyBcIl1cIiArXHJcbiAgICAgICAgICAgIFwiXFxuc2NhbGU6IFtcIiArIChNYXRoLnJvdW5kKHRoaXMuaXRlbS5zY2FsZVggKiAxMDApIC8gMTAwKSArIFwiLCBcIiArIChNYXRoLnJvdW5kKHRoaXMuaXRlbS5zY2FsZVkgKiAxMDApIC8gMTAwKSArIFwiXVwiICtcclxuICAgICAgICAgICAgXCJcXG5vcmlnaW46IFtcIiArIE1hdGgucm91bmQodGhpcy5pdGVtLm9yaWdpblggKiB0aGlzLml0ZW0uZ2V0TWVhc3VyZWRXaWR0aCgpKSArIFwiLCBcIiArIE1hdGgucm91bmQodGhpcy5pdGVtLm9yaWdpblkgKiB0aGlzLml0ZW0uZ2V0TWVhc3VyZWRIZWlnaHQoKSkgKyBcIl1cIjtcclxuXHJcbiAgICAgICAgdGhpcy5zdGF0dXNMYmwudGV4dCA9IHRleHQ7XHJcbiAgICB9XHJcbn0iXX0=